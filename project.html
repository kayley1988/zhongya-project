<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é¡¹ç›®æµ‹ç®— - ä¸­äºšè·¨å¢ƒé¡¹ç›®ç®¡ç†</title>
    <link rel="stylesheet" href="styles.css">
    <script src="lib/chart.min.js"></script>
    <style>
        /* é¡¹ç›®å¤´éƒ¨æ ·å¼ - ç»Ÿä¸€é…è‰² */
        .project-header {
            background: linear-gradient(135deg, #1e1b4b 0%, #312e81 100%);
            color: white;
            padding: 12px 24px;
            display: flex;
            align-items: center;
            gap: 20px;
        }
        .project-header .back-link {
            display: flex;
            align-items: center;
            gap: 6px;
            color: white;
            text-decoration: none;
            padding: 8px 16px;
            background: rgba(255,255,255,0.1);
            border-radius: 6px;
            transition: background 0.2s;
        }
        .project-header .back-link:hover {
            background: rgba(255,255,255,0.2);
        }
        .project-info {
            flex: 1;
        }
        .project-info h2 {
            margin: 0 0 4px 0;
            font-size: 1.3em;
        }
        .project-meta {
            font-size: 0.85em;
            opacity: 0.9;
            display: flex;
            gap: 16px;
        }
        .project-actions-header {
            display: flex;
            gap: 10px;
        }
        .project-actions-header .btn {
            padding: 8px 16px;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.2s;
        }
        .project-actions-header .btn-save {
            background: rgba(255,255,255,0.15);
            color: white;
        }
        .project-actions-header .btn-save:hover {
            background: rgba(255,255,255,0.25);
        }
        .project-actions-header .btn-version {
            background: #4f46e5;
            color: white;
        }
        .project-actions-header .btn-version:hover {
            background: #4338ca;
        }

        /* ç‰ˆæœ¬é¢æ¿æ ·å¼ */
        .version-panel {
            background: #f8f9fa;
            border-bottom: 1px solid #e0e0e0;
            padding: 12px 24px;
            display: flex;
            align-items: center;
            gap: 16px;
        }
        .version-label {
            font-weight: 600;
            color: #333;
        }
        .version-select {
            padding: 6px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            background: white;
            min-width: 200px;
        }
        .version-info {
            color: #666;
            font-size: 0.9em;
        }
        .version-actions {
            margin-left: auto;
            display: flex;
            gap: 8px;
        }
        .version-actions button {
            padding: 6px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: white;
            cursor: pointer;
            font-size: 13px;
        }
        .version-actions button:hover {
            background: #f5f5f5;
        }

        /* ä¿å­˜ç‰ˆæœ¬å¼¹çª— */
        .version-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        .version-modal.show {
            display: flex;
        }
        .version-modal-content {
            background: white;
            border-radius: 12px;
            width: 480px;
            max-width: 90%;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
        }
        .version-modal-header {
            padding: 20px 24px;
            border-bottom: 1px solid #eee;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .version-modal-header h3 {
            margin: 0;
            font-size: 1.2em;
        }
        .version-modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #999;
        }
        .version-modal-body {
            padding: 24px;
        }
        .version-modal-body .form-group {
            margin-bottom: 16px;
        }
        .version-modal-body label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #333;
        }
        .version-modal-body input,
        .version-modal-body select,
        .version-modal-body textarea {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
        }
        .version-modal-footer {
            padding: 16px 24px;
            border-top: 1px solid #eee;
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }
        .version-modal-footer button {
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
        }
        .version-modal-footer .btn-cancel {
            background: #f5f5f5;
            border: 1px solid #ddd;
        }
        .version-modal-footer .btn-cancel:hover {
            background: #ebebeb;
        }
        .version-modal-footer .btn-submit {
            background: #4f46e5;
            border: none;
            color: white;
        }
        .version-modal-footer .btn-submit:hover {
            background: #4338ca;
        }
        
        /* Toast æ ·å¼ */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
        }
        .toast {
            padding: 12px 20px;
            background: #333;
            color: white;
            border-radius: 8px;
            margin-bottom: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            animation: slideIn 0.3s ease;
        }
        .toast.success { background: #10b981; }
        .toast.error { background: #ef4444; }
        .toast.warning { background: #f59e0b; }
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(100px); }
            to { opacity: 1; transform: translateX(0); }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- é¡¹ç›®å¤´éƒ¨ -->
        <div class="project-header">
            <a href="list.html" class="back-link">
                â† è¿”å›åˆ—è¡¨
            </a>
            <div class="project-info">
                <h2 id="projectTitle">åŠ è½½ä¸­...</h2>
                <div class="project-meta">
                    <span id="projectId">ID: --</span>
                    <span id="projectRegion">åŒºåŸŸ: --</span>
                    <span id="projectStatus">çŠ¶æ€: --</span>
                    <span id="projectUpdateTime">æ›´æ–°: --</span>
                </div>
            </div>
            <div class="project-actions-header">
                <button class="btn btn-save" onclick="saveToProject()">
                    ğŸ’¾ ä¿å­˜åˆ°é¡¹ç›®
                </button>
                <button class="btn btn-version" onclick="openVersionModal()">
                    ğŸ“Œ ä¿å­˜ç‰ˆæœ¬
                </button>
            </div>
        </div>

        <!-- ç‰ˆæœ¬é€‰æ‹©é¢æ¿ -->
        <div class="version-panel">
            <span class="version-label">ğŸ“‹ å½“å‰ç‰ˆæœ¬ï¼š</span>
            <select class="version-select" id="versionSelect" onchange="loadVersion(this.value)">
                <option value="">-- é€‰æ‹©ç‰ˆæœ¬ --</option>
            </select>
            <span class="version-info" id="versionInfo">--</span>
            <div class="version-actions">
                <button onclick="compareVersions()">ğŸ“Š ç‰ˆæœ¬å¯¹æ¯”</button>
                <button onclick="exportVersion()">ğŸ“¥ å¯¼å‡º</button>
            </div>
        </div>

        <!-- é¡¶éƒ¨æ§åˆ¶æ¡ -->
        <header class="control-bar">
            <div class="logo">
                <h1>ğŸšœ ä¸­å“ˆè·¨å¢ƒæœºæ¢°è®¾å¤‡ç§Ÿå”®æµ‹ç®—</h1>
            </div>
            <div class="controls">
                <div class="control-group">
                    <label>ä¸šåŠ¡æ¨¡å¼</label>
                    <div class="toggle-buttons" id="modeToggle">
                        <button class="toggle-btn active" data-value="lease">çº¯ç§Ÿèµ</button>
                        <button class="toggle-btn" data-value="lease-to-sell">ç§Ÿè½¬å”®</button>
                    </div>
                </div>
                <div class="control-group">
                    <label>ä»˜æ¬¾æ–¹å¼</label>
                    <div class="toggle-buttons" id="paymentToggle">
                        <button class="toggle-btn active" data-value="full">å…¨æ¬¾</button>
                        <button class="toggle-btn" data-value="financing">èèµ„ç§Ÿèµ</button>
                    </div>
                </div>
                <div class="control-group">
                    <label>å¸ç§è§†å›¾</label>
                    <div class="toggle-buttons" id="currencyToggle">
                        <button class="toggle-btn active" data-value="CNY">äººæ°‘å¸</button>
                        <button class="toggle-btn" data-value="KZT">åšæˆˆ</button>
                    </div>
                </div>
                <div class="control-group">
                    <label>æƒ…æ™¯</label>
                    <div class="toggle-buttons" id="scenarioToggle">
                        <button class="toggle-btn" data-value="optimistic" title="ç§Ÿé‡‘+10%, è¿è´¹-15%, æ±‡ç‡-8%, ç¨è´¹-10%, è¿è¥-15%">ä¹è§‚</button>
                        <button class="toggle-btn active" data-value="baseline" title="æ‰€æœ‰å‚æ•°æŒ‰è¾“å…¥å€¼è®¡ç®—">åŸºå‡†</button>
                        <button class="toggle-btn" data-value="conservative" title="ç§Ÿé‡‘-15%, è¿è´¹+25%, æ±‡ç‡+15%, ç¨è´¹+10%, è¿è¥+20%">ä¿å®ˆ</button>
                    </div>
                </div>
                <div class="control-group actions">
                    <button class="action-btn" onclick="saveProject()">ğŸ’¾ ä¿å­˜</button>
                    <button class="action-btn primary" onclick="exportPDFReport()">ğŸ“„ å¯¼å‡ºæŠ¥å‘Š</button>
                </div>
            </div>
            <div class="status-bar">
                <span class="scenario-tag" id="scenarioTag">åŸºå‡†æƒ…æ™¯</span>
                <span class="update-time" id="updateTime">æœ€è¿‘æ›´æ–°: --</span>
                <span class="data-status" id="dataStatus">âœ… æ•°æ®å®Œæ•´</span>
            </div>
        </header>

        <main class="main-content">
            <!-- å·¦ä¾§è¾“å…¥åŒº -->
            <aside class="input-panel">
                <!-- B1 é¡¹ç›®ä¿¡æ¯ -->
                <section class="input-section" id="sectionB1">
                    <div class="section-header" onclick="toggleSection('sectionB1')">
                        <h3>ğŸ“‹ B1 é¡¹ç›®ä¿¡æ¯</h3>
                        <span class="collapse-icon">â–¼</span>
                    </div>
                    <div class="section-content">
                        <div class="form-group">
                            <label>è®¾å¤‡ç±»å‹ <span class="required">*</span></label>
                            <select id="equipmentType">
                                <option value="æŒ–æ˜æœº">æŒ–æ˜æœº</option>
                                <option value="æ¨åœŸæœº">æ¨åœŸæœº</option>
                                <option value="è£…è½½æœº">è£…è½½æœº</option>
                                <option value="èµ·é‡æœº">èµ·é‡æœº</option>
                                <option value="å‹è·¯æœº">å‹è·¯æœº</option>
                                <option value="é’»æœº">é’»æœº</option>
                                <option value="æ··å‡åœŸè®¾å¤‡">æ··å‡åœŸè®¾å¤‡</option>
                                <option value="å…¶ä»–">å…¶ä»–è®¾å¤‡</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>è®¾å¤‡å‹å· <span class="hint">å¦‚ï¼šCAT320</span></label>
                            <input type="text" id="equipmentModel" placeholder="è¯·è¾“å…¥è®¾å¤‡å‹å·">
                        </div>
                        <div class="form-group">
                            <label>å°æ•° (N) <span class="required">*</span></label>
                            <input type="number" id="quantity" value="1" min="1" required>
                        </div>
                        <div class="form-group">
                            <label>ç§ŸæœŸ (æœˆ) <span class="required">*</span></label>
                            <input type="number" id="leaseTerm" value="12" min="1" max="120" required>
                        </div>
                        <div class="form-group">
                            <label>ç›®æ ‡åŒºåŸŸ <span class="required">*</span></label>
                            <select id="targetRegion" onchange="updateCityOptions()">
                                <option value="å“ˆè¨å…‹æ–¯å¦">ğŸ‡°ğŸ‡¿ å“ˆè¨å…‹æ–¯å¦</option>
                                <option value="ä¹Œå…¹åˆ«å…‹æ–¯å¦">ğŸ‡ºğŸ‡¿ ä¹Œå…¹åˆ«å…‹æ–¯å¦</option>
                                <option value="å‰å°”å‰æ–¯æ–¯å¦">ğŸ‡°ğŸ‡¬ å‰å°”å‰æ–¯æ–¯å¦</option>
                                <option value="å¡”å‰å…‹æ–¯å¦">ğŸ‡¹ğŸ‡¯ å¡”å‰å…‹æ–¯å¦</option>
                                <option value="åœŸåº“æ›¼æ–¯å¦">ğŸ‡¹ğŸ‡² åœŸåº“æ›¼æ–¯å¦</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>é¡¹ç›®åŸå¸‚</label>
                            <select id="targetCity">
                                <option value="é˜¿æ‹‰æœ¨å›¾">é˜¿æ‹‰æœ¨å›¾</option>
                                <option value="é˜¿æ–¯å¡”çº³">é˜¿æ–¯å¡”çº³</option>
                                <option value="å¥‡å§†è‚¯ç‰¹">å¥‡å§†è‚¯ç‰¹</option>
                                <option value="é˜¿å…‹å¥—">é˜¿å…‹å¥—</option>
                                <option value="å¡æ‹‰å¹²è¾¾">å¡æ‹‰å¹²è¾¾</option>
                            </select>
                        </div>
                    </div>
                </section>

                <!-- B2 æ”¶å…¥å‚æ•° -->
                <section class="input-section" id="sectionB2">
                    <div class="section-header" onclick="toggleSection('sectionB2')">
                        <h3>ğŸ’° B2 æ”¶å…¥å‚æ•°</h3>
                        <span class="collapse-icon">â–¼</span>
                    </div>
                    <div class="section-content">
                        <div class="form-group">
                            <label>å•å°æœˆç§Ÿé‡‘ (CNY) <span class="required">*</span></label>
                            <input type="number" id="monthlyRent" value="50000" min="0" step="1000">
                        </div>
                        <div class="form-group">
                            <label>å®‰è£…è°ƒè¯•è´¹ (CNY/å°)</label>
                            <input type="number" id="installationFee" value="5000" min="0">
                        </div>
                        <div class="form-group">
                            <label>è·¨å¢ƒç»´ä¿æœåŠ¡è´¹ (CNY/å¹´/å°)</label>
                            <input type="number" id="maintenanceServiceFee" value="10000" min="0">
                        </div>
                        <div class="form-group lease-to-sell-only" style="display:none;">
                            <label>æœŸæœ«å‡ºå”®å•ä»· (CNY/å°)</label>
                            <input type="number" id="endSalePrice" value="0" min="0">
                        </div>
                        <div class="form-group lease-to-sell-only" style="display:none;">
                            <label>å¤„ç½®è´¹ç”¨æ¯”ä¾‹ (%)</label>
                            <input type="number" id="disposalFeeRate" value="3" min="0" max="20" step="0.5">
                        </div>
                        <div class="output-preview">
                            <strong>æ”¶å…¥é¢„è§ˆï¼š</strong>
                            <div id="revenuePreview">--</div>
                        </div>
                    </div>
                </section>

                <!-- B3 é‡‡è´­ä¸æ®‹å€¼ -->
                <section class="input-section" id="sectionB3">
                    <div class="section-header" onclick="toggleSection('sectionB3')">
                        <h3>ğŸ­ B3 é‡‡è´­ä¸æ®‹å€¼</h3>
                        <span class="collapse-icon">â–¼</span>
                    </div>
                    <div class="section-content">
                        <div class="form-group">
                            <label>é‡‡è´­å•ä»· (CNY/å°) <span class="required">*</span></label>
                            <input type="number" id="purchasePrice" value="800000" min="0" step="10000">
                        </div>
                        <div class="form-group">
                            <label>ç»æµå¯¿å‘½ (å¹´)</label>
                            <input type="number" id="economicLife" value="10" min="1" max="30">
                        </div>
                        <div class="form-group">
                            <label>ç»§ç»­ç»è¥å¤„ç†æ–¹å¼ <span class="hint">å½±å“åˆ©æ¶¦è®¡ç®—å£å¾„</span></label>
                            <select id="continuingOperationMethod">
                                <option value="accounting">ä¼šè®¡å£å¾„ï¼ˆæŒ‰å¯¿å‘½æ‘Šé”€ï¼‰</option>
                                <option value="cashflow">ç°é‡‘æµå£å¾„ï¼ˆä¸€æ¬¡æ€§æ”¯å‡ºï¼‰</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>æœŸæœ«æ®‹å€¼ç‡ (%) 
                                <button type="button" class="btn-mini" onclick="openResidualValueModal()" title="æŸ¥çœ‹æ®‹å€¼æ›²çº¿åˆ†æ">ğŸ“Š æ®‹å€¼åˆ†æ</button>
                            </label>
                            <input type="number" id="residualValueRate" value="10" min="0" max="50" step="1">
                        </div>
                    </div>
                </section>

                <!-- B4 è·¨å¢ƒè¿è¾“ä¸ä¿é™© -->
                <section class="input-section highlight" id="sectionB4">
                    <div class="section-header" onclick="toggleSection('sectionB4')">
                        <h3>ğŸšš B4 è·¨å¢ƒè¿è¾“ä¸ä¿é™©</h3>
                        <span class="collapse-icon">â–¼</span>
                    </div>
                    <div class="section-content">
                        <div class="form-group priority-group">
                            <label>å›½é™…è´¸æ˜“æœ¯è¯­ (Incoterms 2020) <span class="required">*</span></label>
                            <select id="incoterms" onchange="updateTransportResponsibility()">
                                <option value="">-- è¯·é€‰æ‹©è´¸æ˜“æœ¯è¯­ --</option>
                                <option value="EXW">EXW (å·¥å‚äº¤è´§) - ä¹°æ–¹æ‰¿æ‹…å…¨éƒ¨è¿è¾“</option>
                                <option value="FCA">FCA (è´§äº¤æ‰¿è¿äºº) - ä¹°æ–¹æ‰¿æ‹…ä¸»è¦è¿è¾“</option>
                                <option value="FOB">FOB (è£…è¿æ¸¯èˆ¹ä¸Šäº¤è´§) - å¸¸ç”¨äºæµ·è¿</option>
                                <option value="CFR">CFR (æˆæœ¬åŠ è¿è´¹) - å–æ–¹ä»˜å›½é™…è¿è´¹</option>
                                <option value="CIF">CIF (æˆæœ¬+ä¿é™©+è¿è´¹) - å–æ–¹ä»˜è¿è´¹ä¿é™©</option>
                                <option value="DDP">DDP (å®Œç¨åäº¤è´§) - å–æ–¹æ‰¿æ‹…å…¨éƒ¨æˆæœ¬</option>
                            </select>
                        </div>
                        
                        <div class="responsibility-info" id="responsibilityInfo" style="display:none;">
                            <div class="responsibility-summary">
                                <h4>ğŸ“‹ è´¹ç”¨æ‰¿æ‹…è¯´æ˜</h4>
                                <div class="responsibility-grid">
                                    <div class="seller-costs">
                                        <span class="cost-label seller">å–æ–¹æ‰¿æ‹…</span>
                                        <ul id="sellerCosts"></ul>
                                    </div>
                                    <div class="buyer-costs">
                                        <span class="cost-label buyer">ä¹°æ–¹æ‰¿æ‹…</span>
                                        <ul id="buyerCosts"></ul>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- è¿è¾“è´¹ç”¨è¯¦ç»†è¾“å…¥ -->
                        <div class="transport-costs-section" id="transportCostsSection" style="display:none;">
                            <h4>ğŸ’° ä¹°æ–¹æ‰¿æ‹…è´¹ç”¨æ˜ç»†</h4>
                            
                            <div class="form-group cost-item" id="domesticFreightGroup" style="display:none;">
                                <label>å›½å†…æ®µè¿è´¹ (CNY/å°) <span class="required">*</span> 
                                    <span class="hint">å·¥å‚â†’è£…è¿æ¸¯/è¾¹å¢ƒ</span>
                                </label>
                                <input type="number" id="domesticFreight" value="15000" min="0">
                            </div>
                            
                            <div class="form-group cost-item" id="internationalFreightGroup" style="display:none;">
                                <label>å›½é™…æ®µè¿è´¹ (CNY/å°) <span class="required">*</span> 
                                    <span class="hint">è£…è¿æ¸¯â†’ç›®çš„æ¸¯/è¾¹å¢ƒâ†’é¡¹ç›®åœ°</span>
                                </label>
                                <input type="number" id="internationalFreight" value="25000" min="0">
                            </div>
                            
                            <div class="form-group cost-item" id="portChargesGroup" style="display:none;">
                                <label>å£å²¸æ‚è´¹ (CNY/å°) <span class="hint">è£…å¸/ä»“å‚¨/æ¢è£…/é€šå…³</span></label>
                                <input type="number" id="portCharges" value="8000" min="0">
                            </div>
                            
                            <div class="form-group cost-item" id="insuranceGroup" style="display:none;">
                                <label>è¿è¾“ä¿é™©è´¹ç‡ (%)</label>
                                <input type="number" id="insuranceRate" value="0.8" min="0" max="5" step="0.1">
                                <div class="form-sub-group">
                                    <label>ä¿é™©è®¡è´¹åŸºæ•°</label>
                                    <select id="insuranceBase">
                                        <option value="equipment">è®¾å¤‡è´§å€¼</option>
                                        <option value="cif">å«è¿è´¹ä»·å€¼(CIF)</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-group cost-item" id="customsGroup" style="display:none;">
                                <label>æ¸…å…³ä»£ç†è´¹ (CNY/å°) <span class="hint">ç›®çš„åœ°æ¸…å…³æœåŠ¡</span></label>
                                <input type="number" id="customsAgentFee" value="3000" min="0">
                            </div>
                            
                            <div class="form-group cost-item" id="importDutyGroup" style="display:none;">
                                <label>è¿›å£å…³ç¨è´¹ç‡ (%) <span class="hint">æŒ‰è®¾å¤‡CIFä»·å€¼è®¡å¾</span></label>
                                <input type="number" id="importDutyRate" value="0" min="0" max="30" step="0.1">
                            </div>
                            
                            <div class="form-group cost-item" id="destinationDeliveryGroup" style="display:none;">
                                <label>ç›®çš„åœ°é…é€è´¹ (CNY/å°) <span class="hint">æ¸…å…³åâ†’é¡¹ç›®å·¥åœ°</span></label>
                                <input type="number" id="destinationDelivery" value="5000" min="0">
                            </div>
                        </div>

                        <div class="output-preview" id="transportPreviewSection" style="display:none;">
                            <strong>ä¹°æ–¹è¿è¾“æˆæœ¬æ±‡æ€»ï¼š</strong>
                            <div id="transportPreview">--</div>
                            <div id="transportRatioIndicator" class="ratio-indicator">--</div>
                            <div class="cost-breakdown" id="costBreakdown">--</div>
                        </div>
                    </div>
                </section>

                <!-- B5 ç¨è´¹å¼•æ“ -->
                <section class="input-section" id="sectionB5">
                    <div class="section-header" onclick="toggleSection('sectionB5')">
                        <h3>ğŸ§¾ B5 ç¨è´¹å¼•æ“</h3>
                        <span class="collapse-icon">â–¼</span>
                    </div>
                    <div class="section-content">
                        <div class="form-group">
                            <label>è®¡ç¨å£å¾„ <span class="required">*</span></label>
                            <select id="taxBasis">
                                <option value="CIF">CIFï¼ˆåˆ°å²¸ä»·ï¼‰</option>
                                <option value="FOB">FOBï¼ˆç¦»å²¸ä»·ï¼‰</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>å®Œç¨ä»·æ ¼æ„æˆ</label>
                            <div class="checkbox-group">
                                <label><input type="checkbox" id="includeGoods" checked disabled> è´§å€¼</label>
                                <label><input type="checkbox" id="includeFreight" checked> å›½é™…è¿è´¹</label>
                                <label><input type="checkbox" id="includeInsurance" checked> ä¿é™©</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>å…³ç¨ç¨ç‡ (%) <span class="required">*</span></label>
                            <input type="number" id="tariffRate" value="5" min="0" max="100" step="0.1">
                        </div>
                        <div class="form-group">
                            <label>VAT ç¨ç‡ (%) <span class="required">*</span></label>
                            <input type="number" id="vatRate" value="12" min="0" max="30" step="0.1">
                        </div>
                        <div class="form-group">
                            <label>ç¨æ”¶ä¼˜æƒ </label>
                            <div class="checkbox-group">
                                <label><input type="checkbox" id="tariffExempt"> å…å…³ç¨</label>
                                <label><input type="checkbox" id="vatDeductible"> VATå¯æŠµæ‰£</label>
                            </div>
                        </div>
                        <div class="form-group vat-deduct-only" style="display:none;">
                            <label>VAT å¯æŠµæ‰£æ¯”ä¾‹ (%)</label>
                            <input type="number" id="vatDeductRate" value="100" min="0" max="100">
                        </div>
                        <div class="output-preview">
                            <strong>ç¨è´¹é¢„è§ˆï¼š</strong>
                            <div id="taxPreview">--</div>
                        </div>
                    </div>
                </section>

                <!-- B6 è¿è¥ä¸ç»´ä¿ -->
                <section class="input-section" id="sectionB6">
                    <div class="section-header" onclick="toggleSection('sectionB6')">
                        <h3>ğŸ”§ B6 è¿è¥ä¸ç»´ä¿</h3>
                        <span class="collapse-icon">â–¼</span>
                    </div>
                    <div class="section-content">
                        <div class="form-group">
                            <label>å¹´åº¦è·¨å¢ƒç»´ä¿ (CNY/å°) <span class="hint">äººå‘˜å·®æ—…+äººå·¥</span></label>
                            <input type="number" id="annualMaintenance" value="20000" min="0">
                        </div>
                        <div class="form-group">
                            <label>å½“åœ°é…ä»¶é‡‡è´­ (CNY/å¹´/å°)</label>
                            <input type="number" id="localParts" value="15000" min="0">
                        </div>
                        <div class="form-group">
                            <label>å½“åœ°æœåŠ¡å•†è´¹ç”¨ (CNY/å¹´/å°)</label>
                            <input type="number" id="localServiceFee" value="10000" min="0">
                        </div>
                        <div class="form-group">
                            <label>å…¶ä»–è´¹ç”¨ (CNY/å¹´/å°) <span class="hint">å•†åŠ¡å¯¹æ¥ã€åˆè§„ç­‰</span></label>
                            <input type="number" id="otherOperatingCost" value="5000" min="0">
                        </div>
                        <div class="output-preview">
                            <strong>è¿è¥æˆæœ¬é¢„è§ˆï¼š</strong>
                            <div id="operatingPreview">--</div>
                        </div>
                    </div>
                </section>

                <!-- B7 èµ„é‡‘ä¸èèµ„ -->
                <section class="input-section" id="sectionB7">
                    <div class="section-header" onclick="toggleSection('sectionB7')">
                        <h3>ğŸ’³ B7 èµ„é‡‘ä¸èèµ„</h3>
                        <span class="collapse-icon">â–¼</span>
                    </div>
                    <div class="section-content">
                        <!-- å…¨æ¬¾æ¨¡å¼ -->
                        <div class="payment-mode full-payment-mode">
                            <h4>å…¨æ¬¾å«èµ„å‚æ•°</h4>
                            <div class="form-group">
                                <label>é‡‡è´­å«èµ„æ¯”ä¾‹ (%)</label>
                                <input type="number" id="purchaseAdvanceRate" value="100" min="0" max="100">
                            </div>
                            <div class="form-group">
                                <label>è¿è´¹/ç¨è´¹å«èµ„æ¯”ä¾‹ (%)</label>
                                <input type="number" id="freightTaxAdvanceRate" value="100" min="0" max="100">
                            </div>
                            <div class="form-group">
                                <label>å«èµ„å‘¨æœŸ (æœˆ)</label>
                                <input type="number" id="advancePeriod" value="3" min="1" max="24">
                            </div>
                            <div class="form-group">
                                <label>å¹´åŒ–èµ„é‡‘æˆæœ¬åˆ©ç‡ (%)</label>
                                <input type="number" id="capitalCostRate" value="6" min="0" max="30" step="0.1">
                            </div>
                        </div>
                        <!-- èèµ„æ¨¡å¼ -->
                        <div class="payment-mode financing-mode" style="display:none;">
                            <h4>èèµ„ç§Ÿèµå‚æ•°</h4>
                            <div class="form-group">
                                <label>é¦–ä»˜æ¯”ä¾‹ (%)</label>
                                <input type="number" id="downPaymentRate" value="30" min="0" max="100">
                            </div>
                            <div class="form-group">
                                <label>èèµ„åˆ©ç‡ (å¹´åŒ–%)</label>
                                <input type="number" id="financingRate" value="8" min="0" max="30" step="0.1">
                            </div>
                            <div class="form-group">
                                <label>èèµ„æœŸæ•° (æœˆ)</label>
                                <input type="number" id="financingTerm" value="24" min="1" max="120">
                            </div>
                            <div class="form-group">
                                <label>è¿˜æ¬¾æ–¹å¼</label>
                                <select id="repaymentMethod">
                                    <option value="equal">ç­‰é¢æœ¬æ¯</option>
                                    <option value="bullet">åˆ°æœŸè¿˜æœ¬ä»˜æ¯</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>æ‰‹ç»­è´¹ç‡ (%)</label>
                                <input type="number" id="handlingFeeRate" value="1" min="0" max="10" step="0.1">
                            </div>
                        </div>
                        <div class="output-preview">
                            <strong>èµ„é‡‘æˆæœ¬é¢„è§ˆï¼š</strong>
                            <div id="financingPreview">--</div>
                        </div>
                    </div>
                </section>

                <!-- æ±‡ç‡æ¨¡å— -->
                <section class="input-section" id="sectionExchange">
                    <div class="section-header" onclick="toggleSection('sectionExchange')">
                        <h3>ğŸ’± æ±‡ç‡è®¾ç½®</h3>
                        <span class="collapse-icon">â–¼</span>
                    </div>
                    <div class="section-content">
                        <div class="form-group">
                            <label>ç§Ÿé‡‘æŠ¥ä»·å¸ç§</label>
                            <select id="rentCurrency">
                                <option value="CNY">äººæ°‘å¸ (CNY)</option>
                                <option value="KZT">åšæˆˆ (KZT)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>åŸºå‡†æ±‡ç‡ (1 CNY = ? KZT) <span class="required">*</span></label>
                            <div class="exchange-input-group">
                                <input type="number" id="exchangeRate" value="65" min="1" step="0.01">
                                <button type="button" class="btn-fetch-rate" onclick="fetchExchangeRate()" title="è·å–å®æ—¶æ±‡ç‡">
                                    ğŸ”„ è·å–å®æ—¶æ±‡ç‡
                                </button>
                            </div>
                            <div class="rate-source" id="rateSource"></div>
                        </div>
                        <div class="form-group">
                            <label>æ±‡ç‡æ³¢åŠ¨èŒƒå›´ (Â±%)</label>
                            <input type="number" id="exchangeVolatility" value="5" min="0" max="30" step="1">
                        </div>
                        <div class="exchange-links">
                            <a href="https://www.boc.cn/sourcedb/whpj/" target="_blank" rel="noopener">ğŸ“Š ä¸­å›½é“¶è¡Œå¤–æ±‡ç‰Œä»·</a>
                            <a href="https://www.nationalbank.kz/en/exchangerates/ezhednevnye-oficialnye-rynochnye-kursy-valyut" target="_blank" rel="noopener">ğŸ¦ å“ˆè¨å…‹æ–¯å¦å¤®è¡Œ</a>
                        </div>
                        <div class="output-preview">
                            <strong>æ±‡ç‡æƒ…æ™¯ï¼š</strong>
                            <div id="exchangePreview">--</div>
                        </div>
                    </div>
                </section>

                <div class="calculate-actions">
                    <button class="btn-calculate" onclick="calculate()">ğŸ”„ ç«‹å³æµ‹ç®—</button>
                    <button class="btn-reset" onclick="resetForm()">ğŸ”ƒ é‡ç½®å‚æ•°</button>
                </div>
            </aside>

            <!-- å³ä¾§è¾“å‡ºåŒº -->
            <section class="output-panel">
                <!-- PDFæŠ¥å‘Šå¤´éƒ¨ï¼ˆä»…æ‰“å°æ—¶æ˜¾ç¤ºï¼‰ -->
                <div class="pdf-report-header" style="display:none;">
                    <h1>ğŸšœ ä¸­å“ˆè·¨å¢ƒæœºæ¢°è®¾å¤‡ç§Ÿå”®æµ‹ç®—æŠ¥å‘Š</h1>
                    <div class="report-meta">
                        <span id="reportEquipment">è®¾å¤‡: --</span>
                        <span>|</span>
                        <span id="reportMode">æ¨¡å¼: --</span>
                        <span>|</span>
                        <span id="reportDate">æ—¥æœŸ: --</span>
                    </div>
                </div>

                <!-- æœªè¾¾æ ‡è­¦å‘Šæ¡ -->
                <div class="compliance-alert" id="complianceAlert" style="display:none;">
                    <div class="alert-header">
                        <span class="alert-icon">âš ï¸</span>
                        <span class="alert-title" id="alertTitle">éƒ¨åˆ†æŒ‡æ ‡æœªè¾¾æ ‡</span>
                    </div>
                    <div class="alert-issues" id="alertIssues">
                        <!-- åŠ¨æ€å¡«å…… -->
                    </div>
                </div>

                <!-- ç¡¬æŒ‡æ ‡KPIå¡ç‰‡ï¼š3ç§æ¯›åˆ©ç‡ + 2ç§å›æœ¬ -->
                <div class="kpi-section">
                    <div class="kpi-section-header">
                        <h3>ğŸ“Š æ¯›åˆ©ç‡æŒ‡æ ‡ <span class="threshold-hint">è¾¾æ ‡çº¿ï¼šâ‰¥30%</span></h3>
                    </div>
                    <div class="kpi-cards gm-cards">
                        <div class="kpi-card gm-card" onclick="showKPIDetail('gm1')">
                            <div class="kpi-badge">GM1</div>
                            <div class="kpi-label">ç»è¥æ¯›åˆ©ç‡</div>
                            <div class="kpi-value" id="kpiGM1">--</div>
                            <div class="kpi-indicator" id="kpiGM1Indicator">--</div>
                            <div class="kpi-formula">æ”¶å…¥-å¯å˜æˆæœ¬</div>
                            <div class="kpi-detail-icon">ğŸ“Š</div>
                        </div>
                        <div class="kpi-card gm-card" onclick="showKPIDetail('gm2')">
                            <div class="kpi-badge">GM2</div>
                            <div class="kpi-label">å«æ‘Šé”€æ¯›åˆ©ç‡</div>
                            <div class="kpi-value" id="kpiGM2">--</div>
                            <div class="kpi-indicator" id="kpiGM2Indicator">--</div>
                            <div class="kpi-formula">æ”¶å…¥-å¯å˜-æŠ˜æ—§</div>
                            <div class="kpi-detail-icon">ğŸ“Š</div>
                        </div>
                        <div class="kpi-card gm-card" onclick="showKPIDetail('gm3')">
                            <div class="kpi-badge">GM3</div>
                            <div class="kpi-label">å…¨å£å¾„æ¯›åˆ©ç‡</div>
                            <div class="kpi-value" id="kpiGM3">--</div>
                            <div class="kpi-indicator" id="kpiGM3Indicator">--</div>
                            <div class="kpi-formula">æ”¶å…¥-å¯å˜-æŠ˜æ—§-èµ„é‡‘</div>
                            <div class="kpi-detail-icon">ğŸ“Š</div>
                        </div>
                    </div>
                </div>

                <div class="kpi-section">
                    <div class="kpi-section-header">
                        <h3>â±ï¸ å›æœ¬æŒ‡æ ‡ <span class="threshold-hint">è¾¾æ ‡çº¿ï¼šâ‰¤24ä¸ªæœˆ</span></h3>
                    </div>
                    <div class="kpi-cards pb-cards">
                        <div class="kpi-card pb-card" onclick="showKPIDetail('pb1')">
                            <div class="kpi-badge">PB1</div>
                            <div class="kpi-label">é¡¹ç›®å›æœ¬</div>
                            <div class="kpi-value" id="kpiPB1">--</div>
                            <div class="kpi-unit">æœˆ</div>
                            <div class="kpi-indicator" id="kpiPB1Indicator">--</div>
                            <div class="kpi-formula">ä¸è€ƒè™‘èèµ„</div>
                            <div class="kpi-detail-icon">ğŸ“Š</div>
                        </div>
                        <div class="kpi-card pb-card" onclick="showKPIDetail('pb2')">
                            <div class="kpi-badge">PB2</div>
                            <div class="kpi-label">è‚¡ä¸œå›æœ¬</div>
                            <div class="kpi-value" id="kpiPB2">--</div>
                            <div class="kpi-unit">æœˆ</div>
                            <div class="kpi-indicator" id="kpiPB2Indicator">--</div>
                            <div class="kpi-formula">è€ƒè™‘èèµ„ç»“æ„</div>
                            <div class="kpi-detail-icon">ğŸ“Š</div>
                        </div>
                    </div>
                </div>

                <!-- è¾¾æ ‡é˜ˆå€¼åæ¨ -->
                <div class="threshold-panel" id="thresholdPanel">
                    <div class="threshold-header" onclick="toggleThresholdPanel()">
                        <h3>ğŸ¯ è¾¾æ ‡é˜ˆå€¼åæ¨</h3>
                        <span class="collapse-icon">â–¼</span>
                    </div>
                    <div class="threshold-content">
                        <div class="threshold-group">
                            <h4>æ¯›åˆ©ç‡â‰¥30%æ‰€éœ€æœ€ä½æœˆç§Ÿé‡‘</h4>
                            <div class="threshold-items">
                                <div class="threshold-item">
                                    <span class="label">GM1è¾¾æ ‡</span>
                                    <span class="value" id="thresholdRentGM1">--</span>
                                    <span class="compare" id="thresholdRentGM1Compare"></span>
                                </div>
                                <div class="threshold-item">
                                    <span class="label">GM2è¾¾æ ‡</span>
                                    <span class="value" id="thresholdRentGM2">--</span>
                                    <span class="compare" id="thresholdRentGM2Compare"></span>
                                </div>
                                <div class="threshold-item">
                                    <span class="label">GM3è¾¾æ ‡</span>
                                    <span class="value" id="thresholdRentGM3">--</span>
                                    <span class="compare" id="thresholdRentGM3Compare"></span>
                                </div>
                            </div>
                        </div>
                        <div class="threshold-group">
                            <h4>å›æœ¬â‰¤24ä¸ªæœˆæ‰€éœ€å‚æ•°</h4>
                            <div class="threshold-items">
                                <div class="threshold-item">
                                    <span class="label">æœ€å¤§è·¨å¢ƒæˆæœ¬</span>
                                    <span class="value" id="thresholdMaxTransport">--</span>
                                    <span class="compare" id="thresholdMaxTransportCompare"></span>
                                </div>
                                <div class="threshold-item">
                                    <span class="label">æœ€å¤§èµ„é‡‘åˆ©ç‡</span>
                                    <span class="value" id="thresholdMaxRate">--</span>
                                    <span class="compare" id="thresholdMaxRateCompare"></span>
                                </div>
                                <div class="threshold-item">
                                    <span class="label">æœ€çŸ­å«èµ„å‘¨æœŸ</span>
                                    <span class="value" id="thresholdMinPeriod">--</span>
                                    <span class="compare" id="thresholdMinPeriodCompare"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- å›¾è¡¨åŒºåŸŸ -->
                <div class="charts-container">
                    <!-- åŒå›æœ¬æ›²çº¿å›¾ -->
                    <div class="chart-card full-width">
                        <div class="chart-header">
                            <h3>ğŸ“ˆ å›æœ¬åˆ†æï¼ˆPB1 vs PB2ï¼‰</h3>
                            <div class="chart-legend">
                                <span class="legend-item"><span class="legend-color pb1"></span>PB1 é¡¹ç›®å›æœ¬</span>
                                <span class="legend-item"><span class="legend-color pb2"></span>PB2 è‚¡ä¸œå›æœ¬</span>
                            </div>
                        </div>
                        <div class="chart-body">
                            <canvas id="paybackChart"></canvas>
                        </div>
                    </div>

                    <div class="chart-card">
                        <div class="chart-header">
                            <h3>ğŸ“Š æˆæœ¬ç»“æ„åˆ†æ</h3>
                            <div class="chart-toggle">
                                <button class="chart-btn active" onclick="switchCostChart('bar')">æŸ±çŠ¶å›¾</button>
                                <button class="chart-btn" onclick="switchCostChart('pie')">ç¯å½¢å›¾</button>
                            </div>
                        </div>
                        <div class="chart-body">
                            <canvas id="costChart"></canvas>
                        </div>
                    </div>
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3>ğŸ“ˆ æœˆåº¦ç°é‡‘æµ</h3>
                        </div>
                        <div class="chart-body">
                            <canvas id="cashFlowChart"></canvas>
                        </div>
                    </div>
                    <div class="chart-card full-width">
                        <div class="chart-header">
                            <h3>ğŸ“‰ ç´¯è®¡ç°é‡‘æµä¸å›æœ¬åˆ†æ</h3>
                            <div class="chart-toggle">
                                <label><input type="checkbox" id="showScenarios" onchange="updateCumulativeChart()"> æ˜¾ç¤ºæƒ…æ™¯å¯¹æ¯”</label>
                            </div>
                        </div>
                        <div class="chart-body">
                            <canvas id="cumulativeChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- æ•æ„Ÿæ€§åˆ†æ -->
                <div class="sensitivity-panel">
                    <div class="chart-header">
                        <h3>ğŸ¯ æ•æ„Ÿæ€§åˆ†æ</h3>
                    </div>
                    <div class="sensitivity-controls">
                        <div class="form-group">
                            <label>ç›®æ ‡æŒ‡æ ‡</label>
                            <select id="sensitivityTarget" onchange="updateSensitivity()">
                                <option value="profit">å¹´åº¦åˆ©æ¶¦</option>
                                <option value="payback">å›æœ¬æœˆ</option>
                                <option value="irr">IRR</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>å˜åŠ¨å› ç´ </label>
                            <select id="sensitivityVariable" onchange="updateSensitivity()">
                                <option value="rent">ç§Ÿé‡‘</option>
                                <option value="freight">è¿è´¹</option>
                                <option value="tax">ç¨ç‡</option>
                                <option value="exchange">æ±‡ç‡</option>
                                <option value="interest">åˆ©ç‡</option>
                            </select>
                        </div>
                    </div>
                    <div class="chart-body">
                        <canvas id="sensitivityChart"></canvas>
                    </div>
                </div>

                <!-- æ˜ç»†è¡¨ -->
                <div class="detail-tables">
                    <div class="table-section">
                        <div class="table-header" onclick="toggleTable('revenueTable')">
                            <h3>ğŸ“‹ æ”¶å…¥æ˜ç»†</h3>
                            <span class="collapse-icon">â–¼</span>
                        </div>
                        <div class="table-content" id="revenueTable">
                            <table>
                                <thead>
                                    <tr><th>é¡¹ç›®</th><th>å•ä»·</th><th>æ•°é‡</th><th class="currency-header">é‡‘é¢(CNY)</th></tr>
                                </thead>
                                <tbody id="revenueTableBody"></tbody>
                            </table>
                        </div>
                    </div>
                    <div class="table-section">
                        <div class="table-header" onclick="toggleTable('costTable')">
                            <h3>ğŸ“‹ è·¨å¢ƒæˆæœ¬æ˜ç»†</h3>
                            <span class="collapse-icon">â–¼</span>
                        </div>
                        <div class="table-content" id="costTable">
                            <table>
                                <thead>
                                    <tr><th>é¡¹ç›®</th><th>è®¡ç®—å£å¾„</th><th class="currency-header">é‡‘é¢(CNY)</th><th>å æ¯”</th></tr>
                                </thead>
                                <tbody id="costTableBody"></tbody>
                            </table>
                        </div>
                    </div>
                    <div class="table-section">
                        <div class="table-header" onclick="toggleTable('operatingTable')">
                            <h3>ğŸ“‹ è¿è¥ç»´ä¿æ˜ç»†</h3>
                            <span class="collapse-icon">â–¼</span>
                        </div>
                        <div class="table-content collapsed" id="operatingTable">
                            <table>
                                <thead>
                                    <tr><th>é¡¹ç›®</th><th class="currency-header">å¹´åº¦é‡‘é¢(CNY)</th><th class="currency-header">ç§ŸæœŸæ€»é¢(CNY)</th></tr>
                                </thead>
                                <tbody id="operatingTableBody"></tbody>
                            </table>
                        </div>
                    </div>
                    <div class="table-section">
                        <div class="table-header" onclick="toggleTable('financingTable')">
                            <h3>ğŸ“‹ èèµ„/å«èµ„æ˜ç»†</h3>
                            <span class="collapse-icon">â–¼</span>
                        </div>
                        <div class="table-content collapsed" id="financingTable">
                            <table>
                                <thead>
                                    <tr><th>é¡¹ç›®</th><th class="currency-header">é‡‘é¢(CNY)</th><th>è¯´æ˜</th></tr>
                                </thead>
                                <tbody id="financingTableBody"></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- PDFæŠ¥å‘Šé¡µè„šï¼ˆä»…æ‰“å°æ—¶æ˜¾ç¤ºï¼‰ -->
                <div class="pdf-report-footer" style="display:none;">
                    <p>æœ¬æŠ¥å‘Šç”±ã€Œä¸­å“ˆè·¨å¢ƒæœºæ¢°è®¾å¤‡ç§Ÿå”®æµ‹ç®—ç³»ç»Ÿã€è‡ªåŠ¨ç”Ÿæˆ | ä»…ä¾›å†…éƒ¨å†³ç­–å‚è€ƒ</p>
                </div>
            </section>
        </main>

        <!-- KPIè¯¦æƒ…å¼¹çª— -->
        <div class="modal" id="kpiModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="modalTitle">KPIè¯¦æƒ…</h3>
                    <button class="modal-close" onclick="closeModal()">Ã—</button>
                </div>
                <div class="modal-body" id="modalBody">
                    <!-- åŠ¨æ€å†…å®¹ -->
                </div>
            </div>
        </div>
    </div>

    <!-- ä¿å­˜ç‰ˆæœ¬å¼¹çª— -->
    <div class="version-modal" id="versionModal">
        <div class="version-modal-content">
            <div class="version-modal-header">
                <h3>ğŸ“Œ ä¿å­˜æµ‹ç®—ç‰ˆæœ¬</h3>
                <button class="version-modal-close" onclick="closeVersionModal()">&times;</button>
            </div>
            <div class="version-modal-body">
                <div class="form-group">
                    <label>ç‰ˆæœ¬åç§° *</label>
                    <input type="text" id="versionName" placeholder="ä¾‹å¦‚ï¼šæ–¹æ¡ˆA-è°ƒä½ç§Ÿé‡‘">
                </div>
                <div class="form-group">
                    <label>æƒ…æ™¯ç±»å‹</label>
                    <select id="versionScenario">
                        <option value="baseline">åŸºå‡†æƒ…æ™¯</option>
                        <option value="optimistic">ä¹è§‚æƒ…æ™¯</option>
                        <option value="conservative">ä¿å®ˆæƒ…æ™¯</option>
                        <option value="what-if">å‡è®¾åˆ†æ</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>å¤‡æ³¨è¯´æ˜</label>
                    <textarea id="versionNote" rows="3" placeholder="ç‰ˆæœ¬è¯´æ˜ï¼ˆå¯é€‰ï¼‰"></textarea>
                </div>
            </div>
            <div class="version-modal-footer">
                <button class="btn-cancel" onclick="closeVersionModal()">å–æ¶ˆ</button>
                <button class="btn-submit" onclick="saveVersion()">ä¿å­˜ç‰ˆæœ¬</button>
            </div>
        </div>
    </div>

    <!-- æ®‹å€¼åˆ†æå¼¹çª— -->
    <div class="modal-overlay" id="residualValueModal" style="display:none;">
        <div class="modal modal-lg">
            <div class="modal-header">
                <h3>ğŸ“Š è®¾å¤‡æ®‹å€¼åˆ†æ</h3>
                <button class="modal-close" onclick="closeResidualValueModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="rv-summary">
                        <div class="rv-data-source">
                            <span class="data-source-label">ğŸ“‹ æ•°æ®æ¥æºï¼šB1é¡¹ç›®ä¿¡æ¯ + B3é‡‡è´­ä¸æ®‹å€¼</span>
                        </div>
                        <div class="rv-info-item">
                            <span class="rv-label">è®¾å¤‡åŸå€¼</span>
                            <span class="rv-value" id="rvOriginalValue">--</span>
                        </div>
                        <div class="rv-info-item">
                            <span class="rv-label">ç»æµå¯¿å‘½</span>
                            <span class="rv-value" id="rvEconomicLife">--</span>
                        </div>
                        <div class="rv-info-item">
                            <span class="rv-label">å½“å‰ç§ŸæœŸ</span>
                            <span class="rv-value" id="rvLeaseTerm">--</span>
                        </div>
                        <div class="rv-info-item highlight">
                            <span class="rv-label">ç§ŸæœŸæœ«æ®‹å€¼</span>
                            <span class="rv-value" id="rvEndValue">--</span>
                        </div>
                    </div>
                </div>
                
                <div class="rv-methods">
                    <label>æŠ˜æ—§æ–¹æ³•ï¼š</label>
                    <select id="depreciationMethod" onchange="updateResidualValueChart()">
                        <option value="straight">ç›´çº¿æ³•ï¼ˆå¹³å‡å¹´é™æ³•ï¼‰</option>
                        <option value="double">åŒå€ä½™é¢é€’å‡æ³•</option>
                        <option value="sum">å¹´æ•°æ€»å’Œæ³•</option>
                        <option value="units">å·¥ä½œé‡æ³•ï¼ˆæŒ‰ä½¿ç”¨å¼ºåº¦ï¼‰</option>
                    </select>
                    <div class="method-desc" id="methodDesc">
                        æ¯å¹´æŠ˜æ—§é¢ç›¸ç­‰ï¼Œæ®‹å€¼æ›²çº¿ä¸ºç›´çº¿ä¸‹é™
                    </div>
                </div>
                
                <div class="rv-chart-container">
                    <canvas id="residualValueChart"></canvas>
                </div>
                
                <div class="rv-table-container">
                    <h4>ğŸ“‹ é€å¹´æŠ˜æ—§æ˜ç»†è¡¨</h4>
                    <table class="rv-table">
                        <thead>
                            <tr>
                                <th>å¹´ä»½</th>
                                <th>å¹´åˆè´¦é¢ä»·å€¼</th>
                                <th>æœ¬å¹´æŠ˜æ—§</th>
                                <th>ç´¯è®¡æŠ˜æ—§</th>
                                <th>å¹´æœ«è´¦é¢ä»·å€¼</th>
                                <th>æ®‹å€¼ç‡</th>
                            </tr>
                        </thead>
                        <tbody id="rvTableBody">
                        </tbody>
                    </table>
                </div>
                
                <div class="rv-notes">
                    <h4>ğŸ“ æŠ˜æ—§æ–¹æ³•è¯´æ˜</h4>
                    <ul>
                        <li><strong>ç›´çº¿æ³•</strong>ï¼šæ¯å¹´æŠ˜æ—§ç›¸ç­‰ = (åŸå€¼ - æ®‹å€¼) / ç»æµå¯¿å‘½ã€‚é€‚ç”¨äºç£¨æŸå‡åŒ€çš„è®¾å¤‡ã€‚</li>
                        <li><strong>åŒå€ä½™é¢é€’å‡æ³•</strong>ï¼šå‰æœŸæŠ˜æ—§å¤šï¼ŒåæœŸå°‘ã€‚å¹´æŠ˜æ—§ç‡ = 2 / ç»æµå¯¿å‘½ã€‚é€‚ç”¨äºæŠ€æœ¯æ›´æ–°å¿«çš„è®¾å¤‡ã€‚</li>
                        <li><strong>å¹´æ•°æ€»å’Œæ³•</strong>ï¼šæŒ‰å‰©ä½™å¯¿å‘½æƒé‡åˆ†é…æŠ˜æ—§ã€‚é€‚ç”¨äºå‰æœŸæ•ˆèƒ½é«˜çš„è®¾å¤‡ã€‚</li>
                        <li><strong>å·¥ä½œé‡æ³•</strong>ï¼šæŒ‰å®é™…ä½¿ç”¨é‡æŠ˜æ—§ã€‚é€‚ç”¨äºä½¿ç”¨å¼ºåº¦ä¸å‡åŒ€çš„è®¾å¤‡ã€‚</li>
                    </ul>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="applyResidualValue()">ğŸ“Š åº”ç”¨åˆ°B3æ®‹å€¼ç‡</button>
                <button class="btn btn-primary" onclick="closeResidualValueModal()">å…³é—­</button>
            </div>
        </div>
    </div>

    <!-- Toast å®¹å™¨ -->
    <div class="toast-container"></div>

    <script src="db.js"></script>
    <script src="calculator.js"></script>
    <script src="charts.js"></script>
    <script src="app.js"></script>
    <script src="project-integration.js"></script>
    <script src="pdf-export.js"></script>
    <script src="ai-assistant.js"></script>
</body>
</html>
